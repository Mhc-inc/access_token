
<!DOCTYPE html>
<html lang="zh">
    
    <head>
            <title>oauth</title>
            <script src="https://ajax.aspnetcdn.com/ajax/jQuery/jquery-3.2.1.js"></script>
            <script src="https://malsup.github.io/jquery.form.js"></script>
            <!--script>
                
                function post(URL, PARAMS) {
                    var temp = document.createElement("form");
                    temp.action = URL;
                    temp.method = "post";
                    for (var x in PARAMS) {
                        var opt = document.createElement("input");
                        opt.name = x;
                        opt.value = PARAMS[x];
                        // alert(opt.name)
                        temp.appendChild(opt);
                    }
                    document.body.appendChild(temp);
                    temp.submit();
                    document.body.removeChild(temp);
                    return temp;
                }
            </script-->
    </head>
    <body>
        <script type="text/javascript">
            /*
            function sendQuery(url, postData) {
                    let formData = new FormData();
                    for(var key in postData) {
                        formData.append(key, postData.key);
                    }
              
                    return fetch(url, {
                            body: formData,
                            headers: {
                                "Access-Control-Allow-Origin": "*"
                            },
                            method: 'post'
                    });
            }
            */
            function post(URL, PARAMS) {
                    var temp = document.createElement("form");
                    temp.action = URL;
                    temp.method = "post";
                    temp.style.display = "none";
                    temp.id = "f1"
                    for (var x in PARAMS) {
                        var opt = document.createElement("textarea");
                        opt.name = x;
                        opt.value = PARAMS[x];
                        // alert(opt.name)
                        temp.appendChild(opt);
                    }
                    document.body.appendChild(temp);
                    temp.submit();
                }
            if(location.search.includes("code")){
                const code = location.search.split("?code=")[1]
                const client_id = 'ba26e9112eeaca75e996';
                const redirect_uri = 'https://mhc-inc.github.io/access_token';
                const client_secret = '4f506cf79f322a36c52ab634f074debb4c44329e';
                const accessToken_uri = 'https://github.com/login/oauth/access_token';
                /*
                var postData = "?client_id="+client_id+"&client_secret="+client_secret+"&code="+code+"&redirect_uri="+redirect_uri;
                const Http = new XMLHttpRequest();
                const url=accessToken_uri+postData;
                Http.open("POST", url);
                Http.send();
                Http.onreadystatechange=(e)=>{
                    document.all[0].innerHTML = Http.responseText;
                }
                */
                var data = {
                    code:code,
                    client_id:client_id,
                    client_secret:client_secret,
                    redirect_uri:redirect_uri
                };
                post(accessToken_uri,data);
                $(function () {
                    /*
                        获取form元素，调用其ajaxForm(...)方法
                        内部的function(data)的data就是后台返回的数据
                    */
                    $("#f1").ajaxForm(function (data) {
                        console.log(data);
                        console.log("str:" + JSON.stringify(data));
                    });
                });
            }
        </script>
    </body>
</html>
